"use strict";(self.webpackChunktemh=self.webpackChunktemh||[]).push([[148],{5362:(e,i,r)=>{r.d(i,{A:()=>a});var n=r(99992),t=r(70579);const a=(0,n.A)((0,t.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete")},56148:(e,i,r)=>{r.r(i),r.d(i,{default:()=>D});var n=r(65043),t=r(56647),a=r(53969),l=r(55895),o=r(12097),d=r(94799),s=r(53089),u=r(24343),c=r(47471),m=r(38517),f=r(81911),x=r(78776),h=r(85877),b=r(32911),g=r(91449),v=r(75023),p=r(61773),A=r(5362),y=r(40146),j=(r(86213),r(83003)),P=r(87804),C=r(88998),w=r(70579);const D=()=>{const[e,i]=(0,n.useState)([]),[r,D]=(0,n.useState)([]),[N,k]=(0,n.useState)({id:"",name:"",description:"",category:"",quantity:1,unitPrice:"",taxPercent:"",tax:0,discountPercent:"",discount:0,finalAmount:0}),[I,W]=(0,n.useState)(null),[$,S]=(0,n.useState)(null),[q,R]=(0,n.useState)({open:!1,message:"",severity:"success"}),[F,z]=(0,n.useState)(!1),[_,O]=(0,n.useState)(!1),B=(0,j.wA)(),{billingCategory:H}=(0,j.d4)(e=>e.billingCategory),{billingItems:M}=(0,j.d4)(e=>e.billingItems);(0,n.useEffect)(()=>{B((0,P.C9)()),B((0,C.ss)()),z(!1)},[B]);(0,n.useEffect)(()=>{const e=Number(N.quantity)||1,i=Number(N.unitPrice)||0,r=Number(N.taxPercent)||0,n=i*e*(Number(N.discountPercent)||0)/100,t=(n>0?(i*e-n)*r:i*e*r)/100,a=i*e+t-n;k(e=>({...e,tax:t,discount:n,finalAmount:a}))},[N.quantity,N.unitPrice,N.taxPercent,N.discountPercent]);const T=e=>{k({...N,[e.target.name]:e.target.value})},U=()=>{k({name:"",description:"",category:"",quantity:1,unitPrice:"",taxPercent:"",tax:0,discountPercent:"",discount:0,finalAmount:0}),W(null)},G=[{field:"name",headerName:"Item Name",flex:1,minWidth:150},{field:"description",headerName:"Description",flex:2,minWidth:180},{field:"category",headerName:"Category",width:140,valueGetter:e=>(null===e||void 0===e?void 0:e.name)||""},{field:"quantity",headerName:"Qty",width:70},{field:"unitPrice",headerName:"Unit Price",width:110,renderCell:e=>{var i;return`\u20b9${null===(i=e.value)||void 0===i?void 0:i.$numberDecimal}`}},{field:"row",headerName:"Tax %",width:80,renderCell:e=>{const{tax:i,unitPrice:r,quantity:n,discount:t}=e.row;return`${((null===i||void 0===i?void 0:i.$numberDecimal)/(t?((null===r||void 0===r?void 0:r.$numberDecimal)-(null===t||void 0===t?void 0:t.$numberDecimal))*n:(null===r||void 0===r?void 0:r.$numberDecimal)*n)*100).toFixed(2)}%`}},{field:"tax",headerName:"Tax",width:90,renderCell:e=>{var i;return`\u20b9${Number((null===(i=e.value)||void 0===i?void 0:i.$numberDecimal)||0).toFixed(2)}`}},{field:"discountPercent",headerName:"Discount %",width:100,renderCell:e=>{const{discount:i,unitPrice:r,quantity:n}=e.row,t=null!==i&&void 0!==i&&i.$numberDecimal?Number(i.$numberDecimal):Number(i)||0,a=null!==r&&void 0!==r&&r.$numberDecimal?Number(r.$numberDecimal):Number(r)||0,l=Number(n)||1;return`${a*l>0?(t/(a*l)*100).toFixed(2):"0.00"}%`}},{field:"discount",headerName:"Discount",width:100,renderCell:e=>{var i;return`\u20b9${Number((null===(i=e.value)||void 0===i?void 0:i.$numberDecimal)||0).toFixed(2)}`}},{field:"totalPrice",headerName:"Final Amount",width:120,renderCell:e=>{var i;return`\u20b9${Number((null===(i=e.value)||void 0===i?void 0:i.$numberDecimal)||e.value||0).toFixed(2)}`}},{field:"actions",headerName:"Actions",width:140,sortable:!1,renderCell:e=>(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(t.A,{color:"primary",onClick:()=>(e=>{var i,r;console.log(e),k({id:e._id,name:e.name,description:e.description,category:(null===(i=e.category)||void 0===i?void 0:i._id)||e.category||"",quantity:e.quantity||1,unitPrice:(null===(r=e.unitPrice)||void 0===r?void 0:r.$numberDecimal)||e.unitPrice||"",taxPercent:e.taxPercent,tax:e.tax,discountPercent:e.discountPercent,discount:e.discount,finalAmount:e.finalAmount}),W(e._id),window.scrollTo({top:0,behavior:"smooth"})})(e.row),children:(0,w.jsx)(p.A,{})}),(0,w.jsx)(t.A,{color:"error",onClick:()=>S(e.row._id),children:(0,w.jsx)(A.A,{})})]})}];return(0,w.jsxs)(a.A,{sx:{width:"100%"},children:[(0,w.jsxs)(a.A,{sx:{display:"flex",border:"1px solid #ccc",backgroundColor:"#f5f5f5",padding:"10px",marginBottom:"20px"},children:[(0,w.jsx)(l.A,{variant:"h5",color:"textSecondary",children:"Manage Billing Items"}),(0,w.jsx)(o.A,{variant:"contained",color:"primary",sx:{marginLeft:"auto"},onClick:()=>B((0,P.C9)({})),children:"Refresh"})]}),(0,w.jsxs)(a.A,{sx:{maxWidth:1100,mx:"auto",mt:4,p:{xs:1,sm:2}},children:[(0,w.jsxs)(d.A,{sx:{p:3,mb:4,background:"linear-gradient(90deg, #43cea2 0%, #185a9d 100%)",color:"#fff",borderRadius:3,boxShadow:4},children:[(0,w.jsx)(l.A,{variant:"h5",fontWeight:"bold",gutterBottom:!0,children:I?"Update Billing Item":"Create Billing Item"}),(0,w.jsx)("form",{onSubmit:async e=>{e.preventDefault();try{I?(B((0,P._U)(N)).then(e=>{e.error?R({open:!0,message:"Update failed",severity:"error"}):(B((0,P.C9)()),R({open:!0,message:"Item updated!",severity:"success"}))}),W(null)):""===N.name||""===N.unitPrice||""===N.category?R({open:!0,message:"Please fill all required fields",severity:"warning"}):B((0,P.Iz)(N)).then(e=>{e.error?(B((0,P.C9)()),R({open:!0,message:"Creation failed",severity:"error"})):(U(),R({open:!0,message:"Item created!",severity:"success"}))})}catch{R({open:!0,message:"Operation failed",severity:"error"})}},children:(0,w.jsxs)(s.A,{container:!0,spacing:2,alignItems:"center",children:[(0,w.jsx)(s.A,{item:!0,xs:12,sm:2.4,children:(0,w.jsx)(u.A,{label:"Item Name",name:"name",value:N.name,onChange:T,fullWidth:!0,required:!0,variant:"filled",sx:{background:"rgba(255,255,255,0.15)",borderRadius:1,input:{color:"#fff",fontWeight:600},label:{color:"#fff"}}})}),(0,w.jsx)(s.A,{item:!0,xs:12,sm:2.4,children:(0,w.jsx)(u.A,{label:"Description",name:"description",value:N.description,onChange:T,fullWidth:!0,variant:"filled",sx:{background:"rgba(255,255,255,0.15)",borderRadius:1,input:{color:"#fff"},label:{color:"#fff"}}})}),(0,w.jsx)(s.A,{item:!0,xs:12,sm:2,children:(0,w.jsx)(u.A,{select:!0,label:"Category",name:"category",value:N.category,onChange:T,fullWidth:!0,required:!0,variant:"filled",sx:{width:"160px",background:"rgba(255,255,255,0.15)",borderRadius:1,input:{color:"#fff"},label:{color:"#fff"}},children:H&&H.map(e=>(0,w.jsx)(c.A,{value:e._id,children:e.name},e._id))})}),(0,w.jsx)(s.A,{item:!0,xs:12,sm:1,children:(0,w.jsx)(u.A,{label:"Qty",name:"quantity",value:N.quantity,onChange:T,type:"number",fullWidth:!0,required:!0,variant:"filled",sx:{background:"rgba(255,255,255,0.15)",borderRadius:1,input:{color:"#fff"},label:{color:"#fff"}},inputProps:{min:1}})}),(0,w.jsx)(s.A,{item:!0,xs:12,sm:1.2,children:(0,w.jsx)(u.A,{label:"Unit Price",name:"unitPrice",value:N.unitPrice,onChange:T,type:"number",fullWidth:!0,required:!0,variant:"filled",sx:{background:"rgba(255,255,255,0.15)",borderRadius:1,input:{color:"#fff"},label:{color:"#fff"}},inputProps:{min:0}})}),(0,w.jsx)(s.A,{item:!0,xs:12,sm:1,children:(0,w.jsx)(u.A,{label:"Tax %",name:"taxPercent",value:N.taxPercent,onChange:T,type:"number",fullWidth:!0,variant:"filled",sx:{background:"rgba(255,255,255,0.15)",borderRadius:1,input:{color:"#fff"},label:{color:"#fff"}},inputProps:{min:0}})}),(0,w.jsx)(s.A,{item:!0,xs:12,sm:1.2,children:(0,w.jsx)(u.A,{label:"Tax",name:"tax",value:Number(N.tax||0).toFixed(2),InputProps:{readOnly:!0},fullWidth:!0,variant:"filled",sx:{background:"rgba(255,255,255,0.15)",borderRadius:1,input:{color:"#fff"},label:{color:"#fff"}}})}),(0,w.jsx)(s.A,{item:!0,xs:12,sm:1,children:(0,w.jsx)(u.A,{label:"Discount %",name:"discountPercent",value:N.discountPercent,onChange:T,type:"number",fullWidth:!0,variant:"filled",sx:{background:"rgba(255,255,255,0.15)",borderRadius:1,input:{color:"#fff"},label:{color:"#fff"}},inputProps:{min:0}})}),(0,w.jsx)(s.A,{item:!0,xs:12,sm:1.2,children:(0,w.jsx)(u.A,{label:"Discount",name:"discount",value:Number(N.discount||0).toFixed(2),InputProps:{readOnly:!0},fullWidth:!0,variant:"filled",sx:{background:"rgba(255,255,255,0.15)",borderRadius:1,input:{color:"#fff"},label:{color:"#fff"}}})}),(0,w.jsx)(s.A,{item:!0,xs:12,sm:1.2,children:(0,w.jsx)(u.A,{label:"Final Amount",name:"finalAmount",value:Number(N.finalAmount||0).toFixed(2),InputProps:{readOnly:!0},fullWidth:!0,variant:"filled",sx:{background:"rgba(255,255,255,0.15)",borderRadius:1,input:{color:"#fff"},label:{color:"#fff"}}})}),(0,w.jsx)(s.A,{item:!0,xs:12,sm:1.2,children:(0,w.jsx)(o.A,{type:"submit",variant:"contained",color:I?"warning":"secondary",startIcon:(0,w.jsx)(y.A,{}),fullWidth:!0,sx:{height:56,fontWeight:700,fontSize:16,background:I?"linear-gradient(90deg, #f7971e 0%, #ffd200 100%)":"linear-gradient(90deg, #ff9966 0%, #ff5e62 100%)",color:"#fff",boxShadow:2,"&:hover":{background:I?"linear-gradient(90deg, #ffd200 0%, #f7971e 100%)":"linear-gradient(90deg, #ff5e62 0%, #ff9966 100%)"}},children:I?"Update":"Create"})})]})})]}),(0,w.jsxs)(d.A,{sx:{p:2,borderRadius:3,boxShadow:2},children:[(0,w.jsx)(l.A,{variant:"h6",fontWeight:"bold",sx:{mb:2},children:"Billing Items"}),(0,w.jsx)("div",{style:{width:"100%",minHeight:350},children:(0,w.jsx)(v.z,{rows:M||[],columns:G,getRowId:e=>e._id,pageSize:7,rowsPerPageOptions:[7,15,30],autoHeight:!0,disableSelectionOnClick:!0,sx:{background:"rgba(255,255,255,0.97)",borderRadius:2,"& .MuiDataGrid-columnHeaders":{background:"linear-gradient(90deg, #43cea2 0%, #185a9d 100%)",fontWeight:700,fontSize:16},"& .MuiDataGrid-row:hover":{background:"rgba(67,206,162,0.08)"},"& .MuiDataGrid-cell":{fontSize:15}}})})]}),(0,w.jsxs)(m.A,{open:!!$,onClose:()=>S(null),children:[(0,w.jsx)(f.A,{children:"Delete Item?"}),(0,w.jsx)(x.A,{children:"Are you sure you want to delete this billing item? This action cannot be undone."}),(0,w.jsxs)(h.A,{children:[(0,w.jsx)(o.A,{onClick:()=>S(null),color:"primary",children:"Cancel"}),(0,w.jsx)(o.A,{onClick:async()=>{B((0,P.Cb)($)).then(e=>{e.error?R({open:!0,message:"Delete failed",severity:"error"}):(B((0,P.C9)()),S(null),R({open:!0,message:"Item deleted!",severity:"success"}))})},color:"error",variant:"contained",children:"Delete"})]})]}),(0,w.jsx)(b.A,{open:q.open,autoHideDuration:3e3,onClose:()=>R({...q,open:!1}),anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,w.jsx)(g.A,{severity:q.severity,sx:{width:"100%"},children:q.message})})]})]})}}}]);
//# sourceMappingURL=148.6cb50aaa.chunk.js.map