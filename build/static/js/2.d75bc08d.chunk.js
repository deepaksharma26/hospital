"use strict";(self.webpackChunktemh=self.webpackChunktemh||[]).push([[2],{12902:(e,t,n)=>{n.d(t,{a:()=>o});var i=n(53969),r=n(80172),a=n(28549),l=n(70579);const o=e=>{let{open:t,handleClose:n}=e;return(0,l.jsx)(a.A,{open:t,onClose:n,children:(0,l.jsxs)(i.A,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",bgcolor:"background.paper",p:4,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[(0,l.jsx)(r.A,{}),(0,l.jsx)("p",{style:{marginTop:"16px"},children:"Loading data..."})]})})}},86064:(e,t,n)=>{n.d(t,{MW:()=>r,Xw:()=>a,r7:()=>i});const i=e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(e).toLowerCase()),r=e=>/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/.test(String(e)),a=()=>window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth},87002:(e,t,n)=>{n.r(t),n.d(t,{default:()=>R});var i=n(65043),r=n.t(i,2),a=n(46509),l=n(38480),o=n(15651);function s(e,t,n,r,l){const[o,s]=i.useState(()=>l&&n?n(e).matches:r?r(e).matches:t);return(0,a.A)(()=>{if(!n)return;const t=n(e),i=()=>{s(t.matches)};return i(),t.addEventListener("change",i),()=>{t.removeEventListener("change",i)}},[e,n]),o}const d={...r}.useSyncExternalStore;function u(e,t,n,r,a){const l=i.useCallback(()=>t,[t]),o=i.useMemo(()=>{if(a&&n)return()=>n(e).matches;if(null!==r){const{matches:t}=r(e);return()=>t}return l},[l,e,r,a,n]),[s,u]=i.useMemo(()=>{if(null===n)return[l,()=>()=>{}];const t=n(e);return[()=>t.matches,e=>(t.addEventListener("change",e),()=>{t.removeEventListener("change",e)})]},[l,n,e]);return d(u,s,o)}function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{themeId:t}=e;return function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=(0,o.A)();i&&t&&(i=i[t]||i);const r="undefined"!==typeof window&&"undefined"!==typeof window.matchMedia,{defaultMatches:a=!1,matchMedia:c=(r?window.matchMedia:null),ssrMatchMedia:m=null,noSsr:x=!1}=(0,l.A)({name:"MuiUseMediaQuery",props:n,theme:i});let h="function"===typeof e?e(i):e;h=h.replace(/^@media( ?)/m,""),h.includes("print")&&console.warn(["MUI: You have provided a `print` query to the `useMediaQuery` hook.","Using the print media query to modify print styles can lead to unexpected results.","Consider using the `displayPrint` field in the `sx` prop instead.","More information about `displayPrint` on our docs: https://mui.com/system/display/#display-in-print."].join("\n"));return(void 0!==d?u:s)(h,a,c,m,x)}}c();const m=c({themeId:n(50416).A});var x=n(53969),h=n(94799),f=n(55895),p=n(12097),g=n(30998),b=n(66154),y=n(47471),A=n(28259),v=n(87443),j=n(10756),w=n(86172),C=n(81341),P=n(34375),D=n(56647),I=n(94527),S=n(40146),k=n(7261),N=n(78916),q=n(83003),T=n(86064),W=n(88998),M=n(83965),E=n(23937),$=n(87804),F=n(61066),L=n(17193),z=(n(10735),n(12902)),B=n(70579);function Y(e){if(0===e)return"Zero";"number"!==typeof e&&(e=Number(e));const t=["","One","Two","Three","Four","Five","Six","Seven","Eight","Nine","Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"],n=["","","Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety"],i=Math.floor(e/1e7),r=Math.floor(e%1e7/1e5),a=Math.floor(e%1e5/1e3),l=Math.floor(e%1e3/100),o=e%100;let s="";return i&&(s+=Y(i)+" Crore "),r&&(s+=Y(r)+" Lakh "),a&&(s+=Y(a)+" Thousand "),l&&(s+=t[l]+" Hundred "),o&&(""!==s&&(s+="and "),s+=o<20?t[o]:n[Math.floor(o/10)]+(o%10?" "+t[o%10]:"")),s.trim()}const R=()=>{const e=m("(max-width:900px)"),{billingCategory:t}=(0,q.d4)(e=>e.billingCategory),{paymentType:n}=(0,q.d4)(e=>e.paymentType),{financialYears:r}=(0,q.d4)(e=>e.financialYear),{billingItems:a}=(0,q.d4)(e=>e.billingItems),[l,o]=(0,i.useState)(a||[]),[s,d]=(0,i.useState)(!1),u=(0,q.wA)();(0,i.useEffect)(()=>{u((0,W.ss)()),u((0,M.H)()),u((0,E.dL)()),u((0,$.C9)())},[u]);const c=(0,T.Xw)(),R=()=>{d(!0),u((0,F.m7)(U.customerId)).then(e=>{if(e.error)return console.error("Error fetching customer details:",e.error),void d(!1);if(e.payload){const t=e.payload;V(t.customerNotes||""),H({name:t.customerName,address:t.customerAddress,contact:t.customerPhone||""}),t.billingItems?o(t.billingItems):o([])}else console.warn("No customer details found for the given ID")}).catch(e=>{console.error("Error fetching customer details:",e)}),d(!1)},[U,H]=(0,i.useState)({customerId:"",name:"",address:"",contact:""}),[_,K]=(0,i.useState)({billingType:"",financialYear:"",billingDate:(new Date).toISOString().split("T")[0]}),[O,Q]=(0,i.useState)([{billingItems:"",itemName:"",quantity:1,unitPrice:0,taxPercent:0,tax:0,amount:0,discount:0}]),[Z,X]=(0,i.useState)(""),[G,V]=(0,i.useState)(""),[J,ee]=(0,i.useState)(""),[te,ne]=(0,i.useState)({}),[ie,re]=(0,i.useState)({}),ae=e=>{H({...U,[e.target.name]:e.target.value})},le=e=>{K({..._,[e.target.name]:e.target.value})},oe=(e,t,n)=>{const i=O.map((i,r)=>{if(r!==e)return i;const a=e=>"object"===typeof e&&null!==e&&"$numberDecimal"in e?Number(e.$numberDecimal):Number(e)||0;let l={...i,[t]:["quantity","unitPrice","discount","taxPercent","tax"].includes(t)?a(n):n};return l.unitPrice=a(l.unitPrice),l.quantity=a(l.quantity),l.discount=a(l.discount),l.taxPercent=a(l.taxPercent),l.tax=a(l.tax),"taxPercent"!==t&&"unitPrice"!==t&&"quantity"!==t||(l.tax=(l.unitPrice*l.quantity*l.taxPercent/100).toFixed(2)),"tax"===t&&(l.taxPercent=l.unitPrice&&l.quantity?(100*l.tax/(l.unitPrice*l.quantity)).toFixed(2):0),l.amount=l.unitPrice*l.quantity+Number(l.tax)-l.discount,l});if(Q(i),"itemName"===t){const t=a&&a.filter(e=>e.name.toLowerCase().includes(n.toLowerCase()));ne(n=>({...n,[e]:t})),re(t=>({...t,[e]:void 0}))}},se=()=>{Q([...O,{billingItems:"",itemName:"",quantity:0,unitPrice:0,taxPercent:0,tax:0,amount:0,discount:0}])},de=(e,t)=>{const n=e=>"object"===typeof e&&null!==e&&"$numberDecimal"in e?Number(e.$numberDecimal):Number(e)||0,i=O.map((i,r)=>{if(r!==e)return i;const a=n(t.unitPrice),l=n(t.quantity)||1,o=n(t.taxPercent||t.tax_percent||0);let s=n(t.tax);o&&(s=a*l*o/100);const d=n(t.discount),u=a*l+s-d;return{...i,billingItems:t._id,itemName:t.name,quantity:l,unitPrice:a,taxPercent:o,tax:s,discount:d,amount:u}});Q(i),ne(t=>({...t,[e]:[]}))},ue=O.reduce((e,t)=>e+t.amount,0),ce=O.reduce((e,t)=>{let n=t.tax;return n="object"===typeof n&&null!==n&&"$numberDecimal"in n?Number(n.$numberDecimal):Number(n)||0,e+n},0),me=O.reduce((e,t)=>{let n=t.discount;return n="object"===typeof n&&null!==n&&"$numberDecimal"in n?Number(n.$numberDecimal):Number(n)||0,e+n},0);return(0,B.jsxs)(x.A,{sx:{width:{xs:"100%",md:c-240+"px"},mx:"auto",mt:3,p:{xs:1,sm:2}},children:[(0,B.jsxs)(h.A,{sx:{p:3,mb:3,background:"linear-gradient(90deg, #43cea2 0%, #185a9d 100%)",color:"#fff",borderRadius:3,boxShadow:4,display:"flex",alignItems:"center",justifyContent:"space-between",flexDirection:{xs:"column",md:"row"}},children:[(0,B.jsx)(f.A,{variant:e?"h6":"h4",fontWeight:"bold",children:"User Billing Information"}),(0,B.jsx)(p.A,{variant:"contained",color:"secondary",sx:{fontWeight:700,background:"linear-gradient(90deg, #ff9966 0%, #ff5e62 100%)",color:"#fff",boxShadow:2,mt:{xs:2,md:0},"&:hover":{background:"linear-gradient(90deg, #ff5e62 0%, #ff9966 100%)"}},onClick:()=>window.location.href=L.K.LISTBILLIS,children:"Search Billings"})]}),(0,B.jsx)(h.A,{sx:{mb:3,p:3,borderRadius:3,boxShadow:2,background:"rgba(255,255,255,0.97)"},children:(0,B.jsxs)(g.A,{container:!0,spacing:2,children:[(0,B.jsx)(g.A,{item:!0,xs:12,sm:3,children:(0,B.jsx)(b.A,{label:"Customer ID",name:"customerId",value:U.customerId,onChange:ae,onBlur:R,onKeyDown:e=>{"Tab"!==e.key&&"Enter"!==e.key||R()},fullWidth:!0,required:!0,inputProps:{autoComplete:"off"}})}),(0,B.jsx)(g.A,{item:!0,xs:12,sm:3,children:(0,B.jsx)(b.A,{label:"Name",name:"name",value:U.name,onChange:ae,fullWidth:!0,required:!0,inputProps:{autoComplete:"off"}})}),(0,B.jsx)(g.A,{item:!0,xs:12,sm:3,children:(0,B.jsx)(b.A,{label:"Address",name:"address",value:U.address,onChange:ae,fullWidth:!0,required:!0,inputProps:{autoComplete:"off"}})}),(0,B.jsx)(g.A,{item:!0,xs:12,sm:3,children:(0,B.jsx)(b.A,{label:"Contact",name:"contact",value:U.contact,onChange:ae,fullWidth:!0,required:!0,inputProps:{autoComplete:"off"}})}),(0,B.jsx)(g.A,{item:!0,xs:12,sm:4,children:(0,B.jsx)(b.A,{select:!0,label:"Billing Type",name:"billingType",value:_.billingType,onChange:le,fullWidth:!0,required:!0,sx:{width:180},inputProps:{autoComplete:"off"},children:t&&t.map(e=>(0,B.jsx)(y.A,{value:e,children:null===e||void 0===e?void 0:e.name},e))})}),(0,B.jsx)(g.A,{item:!0,xs:12,sm:4,children:(0,B.jsx)(b.A,{select:!0,label:"Financial Year",name:"financialYear",value:_.financialYear?_.financialYear:"2025-26",onChange:le,fullWidth:!0,required:!0,sx:{width:180},inputProps:{autoComplete:"off"},children:r&&r.map(e=>(0,B.jsx)(y.A,{value:null===e||void 0===e?void 0:e.name,children:null===e||void 0===e?void 0:e.name},null===e||void 0===e?void 0:e._id))})}),(0,B.jsx)(g.A,{item:!0,xs:12,sm:4,children:(0,B.jsx)(b.A,{label:"Billing Date",name:"billingDate",type:"date",value:_.billingDate,onChange:le,fullWidth:!0,InputLabelProps:{shrink:!0},required:!0,inputProps:{autoComplete:"off"}})})]})}),(0,B.jsxs)(h.A,{sx:{p:2,mb:3,borderRadius:3,boxShadow:2,background:"rgba(255,255,255,0.97)"},children:[(0,B.jsxs)(x.A,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:2,alignItems:{xs:"flex-start",md:"center"},justifyContent:"space-between",borderBottom:"1px solid #CECECE",padding:"10px",mb:2,backgroundColor:"#f5f5f5"},children:[(0,B.jsx)(f.A,{variant:"h6",gutterBottom:!0,children:"Billing Details"}),(0,B.jsxs)(f.A,{variant:"h6",sx:{textAlign:"right",justifyContent:"flex-end"},gutterBottom:!0,children:["Financial Year: ",_.financialYear?_.financialYear:"2025-26"]})]}),(0,B.jsx)(A.A,{sx:{minHeight:300},children:(0,B.jsxs)(v.A,{size:"small",children:[(0,B.jsx)(j.A,{children:(0,B.jsxs)(w.A,{children:[(0,B.jsx)(C.A,{width:"450rem",children:"Item Name"}),(0,B.jsx)(C.A,{width:"60rem",children:"Quantity"}),(0,B.jsx)(C.A,{width:"120rem",children:"Unit Price"}),(0,B.jsx)(C.A,{width:"80rem",children:"Tax %"}),(0,B.jsx)(C.A,{width:"80rem",children:"Tax"}),(0,B.jsx)(C.A,{width:"80rem",children:"Discount"}),(0,B.jsx)(C.A,{width:"60rem",children:"Amount"}),(0,B.jsx)(C.A,{children:"Action"})]})}),(0,B.jsx)(P.A,{children:O.map((e,t)=>{var n;return(0,B.jsxs)(w.A,{children:[(0,B.jsxs)(C.A,{sx:{position:"relative"},children:[(0,B.jsx)(b.A,{fullWidth:!0,value:e.itemName,onChange:e=>oe(t,"itemName",e.target.value),placeholder:"Item Name",size:"small",required:!0,autoComplete:"off",InputProps:{endAdornment:e.itemName&&(0,B.jsx)(D.A,{size:"small",onClick:()=>oe(t,"itemName",""),edge:"end","aria-label":"clear",children:(0,B.jsx)(N.A,{fontSize:"small"})})},onKeyDown:e=>{te[t]&&te[t].length>0&&("ArrowDown"===e.key?(e.preventDefault(),re(e=>({...e,[t]:void 0===e[t]||e[t]===te[t].length-1?0:e[t]+1}))):"ArrowUp"===e.key?(e.preventDefault(),re(e=>({...e,[t]:e[t]&&0!==e[t]?e[t]-1:te[t].length-1}))):"Tab"!==e.key&&"Enter"!==e.key||void 0!==ie[t]&&te[t][ie[t]]&&(e.preventDefault(),de(t,te[t][ie[t]]),re(e=>({...e,[t]:void 0}))))}}),te[t]&&te[t].length>0&&(0,B.jsx)(x.A,{fullWidth:!0,sx:{position:"absolute",zIndex:10,background:"#fff",boxShadow:2,borderRadius:1,mt:1,width:"100%",maxHeight:180,overflowY:"auto"},children:te[t].map((e,n)=>(0,B.jsx)(x.A,{sx:{px:2,py:1,cursor:"pointer",borderBottom:"1px solid #eee",backgroundColor:ie[t]===n?"#e3f2fd":"#fff","&:hover":{backgroundColor:"#f0f0f0"}},onMouseEnter:()=>re(e=>({...e,[t]:n})),onMouseLeave:()=>re(e=>({...e,[t]:void 0})),onClick:()=>{de(t,e),re(e=>({...e,[t]:void 0}))},children:e.name},e._id||n))})]}),(0,B.jsx)(C.A,{children:(0,B.jsx)(b.A,{fullWidth:!0,type:"text",value:e.quantity,onChange:e=>oe(t,"quantity",e.target.value),size:"small",inputProps:{min:1},required:!0})}),(0,B.jsx)(C.A,{children:(0,B.jsx)(b.A,{fullWidth:!0,type:"text",value:"object"===typeof e.unitPrice&&null!==e.unitPrice&&"$numberDecimal"in e.unitPrice?e.unitPrice.$numberDecimal:e.unitPrice,onChange:e=>oe(t,"unitPrice",e.target.value),size:"small",inputProps:{min:0},required:!0})}),(0,B.jsx)(C.A,{children:(0,B.jsx)(b.A,{fullWidth:!0,type:"text",value:e.taxPercent,onChange:e=>oe(t,"taxPercent",e.target.value),size:"small",inputProps:{min:0}})}),(0,B.jsx)(C.A,{children:(0,B.jsx)(b.A,{fullWidth:!0,type:"text",value:e.tax,onChange:e=>oe(t,"tax",e.target.value),size:"small",inputProps:{min:0}})}),(0,B.jsx)(C.A,{children:(0,B.jsx)(b.A,{fullWidth:!0,type:"text",value:(null===(n=e.discount)||void 0===n?void 0:n.$numberDecimal)||e.discount,onChange:e=>oe(t,"discount",e.target.value),size:"small",inputProps:{min:0}})}),(0,B.jsx)(C.A,{children:(0,B.jsx)(f.A,{children:e.amount.toFixed(2)})}),(0,B.jsxs)(C.A,{children:[(0,B.jsx)(D.A,{color:"error",onClick:()=>(e=>{Q(O.filter((t,n)=>n!==e))})(t),disabled:1===O.length,children:(0,B.jsx)(k.A,{})}),t===O.length-1&&(0,B.jsx)(D.A,{color:"primary",onClick:se,children:(0,B.jsx)(S.A,{})})]})]},t)})})]})})]}),(0,B.jsxs)(h.A,{sx:{p:3,mb:3,borderRadius:3,boxShadow:2,background:"linear-gradient(90deg, #43cea2 0%, #185a9d 100%)",color:"#fff"},children:[(0,B.jsx)(f.A,{variant:"h6",gutterBottom:!0,children:"Billing Summary"}),(0,B.jsxs)(x.A,{sx:{flexGrow:1,display:"flex",flexDirection:{xs:"column",md:"row"},alignItems:{xs:"flex-start",md:"center"},justifyContent:"space-between",width:"100%",gap:2},children:[(0,B.jsxs)(x.A,{children:[(0,B.jsxs)(f.A,{variant:"subtitle1",children:["Total Amount: ",(0,B.jsxs)("b",{children:["\u20b9",ue.toFixed(2)]})]}),(0,B.jsxs)(f.A,{variant:"subtitle1",children:["Total Tax: ",(0,B.jsxs)("b",{children:["\u20b9",ce?parseFloat(ce).toFixed(2):0]})]}),(0,B.jsxs)(f.A,{variant:"subtitle1",children:["Total Discount: ",(0,B.jsxs)("b",{children:["\u20b9",me.toFixed(2)]})]}),(0,B.jsxs)(f.A,{variant:"subtitle1",sx:{mt:1},children:["In Words: ",(0,B.jsxs)("i",{children:[Y(Math.floor(ue+ce))," Rupees Only"]})]})]}),(0,B.jsxs)(x.A,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:2,alignItems:"flex-end",width:{xs:"100%",md:"auto"}},children:[(0,B.jsx)(b.A,{label:"Remark",value:Z,onChange:e=>X(e.target.value),fullWidth:!0,multiline:!0,rows:2,sx:{minWidth:180}}),(0,B.jsx)(b.A,{label:"Customer Note",value:G,onChange:e=>V(e.target.value),fullWidth:!0,multiline:!0,rows:2,sx:{minWidth:180}}),(0,B.jsx)(b.A,{select:!0,label:"Payment Method",name:"paymentMethod",value:J,onChange:e=>ee(e.target.value),fullWidth:!0,required:!0,sx:{minWidth:180},children:n&&n.map(e=>(0,B.jsx)(y.A,{value:null===e||void 0===e?void 0:e.paymentType,children:null===e||void 0===e?void 0:e.paymentType},null===e||void 0===e?void 0:e.paymentType))})]})]}),(0,B.jsx)(I.A,{sx:{my:2,borderColor:"rgba(255,255,255,0.3)"}}),(0,B.jsx)(x.A,{sx:{display:"flex",justifyContent:"flex-end"},children:(0,B.jsx)(p.A,{type:"submit",variant:"contained",color:"secondary",size:"large",onClick:e=>{var t;e.preventDefault();const n={userId:U.customerId,plan:(null===_||void 0===_||null===(t=_.billingType)||void 0===t?void 0:t.name)||"",details:Z,billingDetails:O.map(e=>({billingItems:e.billingItems?e.billingItems:"",name:e.itemName,quantity:e.quantity,unitPrice:e.unitPrice,totalPrice:e.amount,tax:e.tax||0,discount:e.discount||0})),customerName:U.name,customerAddress:U.address,customerPhone:U.contact,category:_.financialYear,invoiceNumber:`INV-${Date.now()}`,invoiceDate:_.billingDate||new Date,dueDate:new Date((new Date).setDate((new Date).getDate()+30)),totalAmount:ue,taxAmount:O.reduce((e,t)=>e+(t.tax||0),0),discountAmount:O.reduce((e,t)=>e+(t.discount||0),0),finalAmount:ue+O.reduce((e,t)=>e+(t.tax||0),0)-O.reduce((e,t)=>e+(t.discount||0),0),currency:"INR",paymentStatus:"Pending",paymentDate:new Date,paymentReference:"",paymentMethodDetails:J};u((0,F.PM)(n)).then(e=>{e.error?console.error("Error adding billing item:",e.error):window.location.href="/list-billings"}).catch(e=>{console.error("Error adding billing item:",e)})},sx:{fontWeight:700,fontSize:16,background:"linear-gradient(90deg, #ff9966 0%, #ff5e62 100%)",color:"#fff",boxShadow:2,"&:hover":{background:"linear-gradient(90deg, #ff5e62 0%, #ff9966 100%)"}},children:"Submit Billing"})})]}),(0,B.jsx)(z.a,{open:s})]})}}}]);
//# sourceMappingURL=2.d75bc08d.chunk.js.map