"use strict";(self.webpackChunktemh=self.webpackChunktemh||[]).push([[369],{27369:(e,t,n)=>{n.r(t),n.d(t,{default:()=>W});var i=n(65043),a=n(53969),l=n(94799),r=n(55895),o=n(12097),s=n(53089),d=n(24343),u=n(47471),c=n(28259),m=n(87443),x=n(10756),h=n(86172),f=n(81341),p=n(34375),g=n(56647),b=n(94527),y=n(40146),A=n(7261),j=n(78916),v=n(83003),C=n(86064),P=n(88998),w=n(83965),D=n(23937),I=n(87804),S=n(61066),N=n(17193),k=n(73216),T=n(70579);function q(e){if(0===e)return"Zero";"number"!==typeof e&&(e=Number(e));const t=["","One","Two","Three","Four","Five","Six","Seven","Eight","Nine","Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"],n=["","","Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety"],i=Math.floor(e/1e7),a=Math.floor(e%1e7/1e5),l=Math.floor(e%1e5/1e3),r=Math.floor(e%1e3/100),o=e%100;let s="";return i&&(s+=q(i)+" Crore "),a&&(s+=q(a)+" Lakh "),l&&(s+=q(l)+" Thousand "),r&&(s+=t[r]+" Hundred "),o&&(""!==s&&(s+="and "),s+=o<20?t[o]:n[Math.floor(o/10)]+(o%10?" "+t[o%10]:"")),s.trim()}const W=()=>{const e=(0,k.g)().billingId,{billingCategory:t}=(0,v.d4)(e=>e.billingCategory),{paymentType:n}=(0,v.d4)(e=>e.paymentType),{financialYears:W}=(0,v.d4)(e=>e.financialYear),{billingItems:F}=(0,v.d4)(e=>e.billingItems),E=(0,v.wA)(),{billingData:$}=(0,v.d4)(e=>e.billing),z=(0,C.Xw)(),[B,L]=(0,i.useState)({customerId:"",name:"",address:"",contact:""}),[M,Y]=(0,i.useState)({billingType:"",financialYear:"",billingDate:(new Date).toISOString().split("T")[0]}),[R,O]=(0,i.useState)([{billingItems:"",itemName:"",quantity:1,unitPrice:0,taxPercent:0,tax:0,amount:0,discount:0}]),[H,Z]=(0,i.useState)(""),[_,K]=(0,i.useState)(""),[U,X]=(0,i.useState)(""),[G,J]=(0,i.useState)({}),[Q,V]=(0,i.useState)({}),ee=(0,k.Zp)();(0,i.useEffect)(()=>{E((0,S.si)(e)).then(e=>{e.error?console.error("Error fetching billing data:",e.error):(L({customerId:e.payload.userId,name:e.payload.customerName||"",address:e.payload.customerAddress||"",contact:e.payload.customerPhone||""}),Y({billingType:e.payload.plan||"",financialYear:e.payload.category||"",billingDate:e.payload.invoiceDate?new Date(e.payload.invoiceDate).toISOString().split("T")[0]:(new Date).toISOString().split("T")[0]}),O(e.payload.billingDetails.map(e=>({billingItems:e.billingItems||"",itemName:e.name||"",quantity:e.quantity||1,unitPrice:e.unitPrice||0,taxPercent:e.taxPercent||0,tax:e.tax||0,amount:e.totalPrice||0,discount:e.discount||0}))),Z(e.payload.details||""),K(e.payload.customerNotes||""),X(e.payload.paymentMethodDetails||""),J({}),V({}))}).catch(e=>{console.error("Error fetching billing data:",e)}),E((0,P.ss)()),E((0,w.H)()),E((0,D.dL)()),E((0,I.C9)())},[E,e]);const te=e=>{L({...B,[e.target.name]:e.target.value})},ne=e=>{Y({...M,[e.target.name]:e.target.value})},ie=(e,t,n)=>{const i=R.map((i,a)=>{if(a!==e)return i;const l=e=>"object"===typeof e&&null!==e&&"$numberDecimal"in e?Number(e.$numberDecimal):Number(e)||0;let r={...i,[t]:["quantity","unitPrice","discount","taxPercent","tax"].includes(t)?l(n):n};return r.unitPrice=l(r.unitPrice),r.quantity=l(r.quantity),r.discount=l(r.discount),r.taxPercent=l(r.taxPercent),r.tax=l(r.tax),"taxPercent"!==t&&"unitPrice"!==t&&"quantity"!==t||(r.tax=(r.unitPrice*r.quantity*r.taxPercent/100).toFixed(2)),"tax"===t&&(r.taxPercent=r.unitPrice&&r.quantity?(100*r.tax/(r.unitPrice*r.quantity)).toFixed(2):0),r.amount=r.unitPrice*r.quantity+Number(r.tax)-r.discount,r});if(O(i),"itemName"===t){const t=F&&F.filter(e=>e.name.toLowerCase().includes(n.toLowerCase()));J(n=>({...n,[e]:t})),V(t=>({...t,[e]:void 0}))}},ae=()=>{O([...R,{billingItems:"",itemName:"",quantity:1,unitPrice:0,taxPercent:0,tax:0,amount:0,discount:0}])},le=(e,t)=>{const n=e=>"object"===typeof e&&null!==e&&"$numberDecimal"in e?Number(e.$numberDecimal):Number(e)||0,i=R.map((i,a)=>{if(a!==e)return i;const l=n(t.unitPrice),r=n(t.quantity)||1,o=n(t.taxPercent||t.tax_percent||0);let s=n(t.tax);o&&(s=l*r*o/100);const d=n(t.discount),u=l*r+s-d;return{...i,billingItems:t._id,itemName:t.name,quantity:r,unitPrice:l,taxPercent:o,tax:s,discount:d,amount:u}});O(i),J(t=>({...t,[e]:[]}))},re=R.reduce((e,t)=>e+t.amount,0),oe=R.reduce((e,t)=>{let n=t.tax;return n="object"===typeof n&&null!==n&&"$numberDecimal"in n?Number(n.$numberDecimal):Number(n)||0,e+n},0),se=R.reduce((e,t)=>{let n=t.discount;return n="object"===typeof n&&null!==n&&"$numberDecimal"in n?Number(n.$numberDecimal):Number(n)||0,e+n},0);return(0,T.jsxs)(a.A,{sx:{width:{xs:"100%",md:z-240+"px"},mx:"auto",mt:3,p:{xs:1,sm:2}},children:[(0,T.jsxs)(l.A,{sx:{p:3,mb:3,background:"linear-gradient(90deg, #43cea2 0%, #185a9d 100%)",color:"#fff",borderRadius:3,boxShadow:4,display:"flex",alignItems:"center",justifyContent:"space-between",flexDirection:{xs:"column",md:"row"}},children:[(0,T.jsx)(r.A,{variant:"h5",fontWeight:"bold",children:"Edit Billing Information"}),(0,T.jsx)(o.A,{variant:"contained",color:"secondary",sx:{fontWeight:700,background:"linear-gradient(90deg, #ff9966 0%, #ff5e62 100%)",color:"#fff",boxShadow:2,mt:{xs:2,md:0},"&:hover":{background:"linear-gradient(90deg, #ff5e62 0%, #ff9966 100%)"}},onClick:()=>ee(N.K.LISTBILLIS),children:"Search Billings"})]}),(0,T.jsx)(l.A,{sx:{mb:3,p:3,borderRadius:3,boxShadow:2,background:"rgba(255,255,255,0.97)"},children:(0,T.jsxs)(s.A,{container:!0,spacing:2,children:[(0,T.jsx)(s.A,{item:!0,xs:12,sm:3,children:(0,T.jsx)(d.A,{label:"Customer ID",name:"customerId",value:B.customerId,onChange:te,fullWidth:!0,required:!0,inputProps:{autoComplete:"off"}})}),(0,T.jsx)(s.A,{item:!0,xs:12,sm:3,children:(0,T.jsx)(d.A,{label:"Name",name:"name",value:B.name,onChange:te,fullWidth:!0,required:!0,inputProps:{autoComplete:"off"}})}),(0,T.jsx)(s.A,{item:!0,xs:12,sm:3,children:(0,T.jsx)(d.A,{label:"Address",name:"address",value:B.address,onChange:te,fullWidth:!0,required:!0,inputProps:{autoComplete:"off"}})}),(0,T.jsx)(s.A,{item:!0,xs:12,sm:3,children:(0,T.jsx)(d.A,{label:"Contact",name:"contact",value:B.contact,onChange:te,fullWidth:!0,required:!0,inputProps:{autoComplete:"off"}})}),(0,T.jsx)(s.A,{item:!0,xs:12,sm:4,children:(0,T.jsx)(d.A,{select:!0,label:"Billing Type",name:"billingType",value:M.billingType,onChange:ne,fullWidth:!0,required:!0,sx:{width:180},inputProps:{autoComplete:"off"},children:t&&t.map(e=>(0,T.jsx)(u.A,{value:null===e||void 0===e?void 0:e.name,children:null===e||void 0===e?void 0:e.name},e))})}),(0,T.jsx)(s.A,{item:!0,xs:12,sm:4,children:(0,T.jsx)(d.A,{select:!0,label:"Financial Year",name:"financialYear",value:M.financialYear?M.financialYear:"2025-26",onChange:ne,fullWidth:!0,required:!0,sx:{width:180},inputProps:{autoComplete:"off"},children:W&&W.map(e=>(0,T.jsx)(u.A,{value:null===e||void 0===e?void 0:e.name,children:null===e||void 0===e?void 0:e.name},null===e||void 0===e?void 0:e._id))})}),(0,T.jsx)(s.A,{item:!0,xs:12,sm:4,children:(0,T.jsx)(d.A,{label:"Billing Date",name:"billingDate",type:"date",value:M.billingDate,onChange:ne,fullWidth:!0,InputLabelProps:{shrink:!0},required:!0,inputProps:{autoComplete:"off"}})})]})}),(0,T.jsxs)(l.A,{sx:{p:2,mb:3,borderRadius:3,boxShadow:2,background:"rgba(255,255,255,0.97)"},children:[(0,T.jsxs)(a.A,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:2,alignItems:{xs:"flex-start",md:"center"},justifyContent:"space-between",borderBottom:"1px solid #CECECE",padding:"10px",mb:2,backgroundColor:"#f5f5f5"},children:[(0,T.jsx)(r.A,{variant:"h6",gutterBottom:!0,children:"Billing Details"}),(0,T.jsxs)(r.A,{variant:"h6",sx:{textAlign:"right",justifyContent:"flex-end"},gutterBottom:!0,children:["Financial Year: ",M.financialYear?M.financialYear:"2025-26"]})]}),(0,T.jsx)(c.A,{sx:{minHeight:300},children:(0,T.jsxs)(m.A,{size:"small",children:[(0,T.jsx)(x.A,{children:(0,T.jsxs)(h.A,{children:[(0,T.jsx)(f.A,{width:"450rem",children:"Item Name"}),(0,T.jsx)(f.A,{width:"60rem",children:"Quantity"}),(0,T.jsx)(f.A,{width:"120rem",children:"Unit Price"}),(0,T.jsx)(f.A,{width:"80rem",children:"Tax %"}),(0,T.jsx)(f.A,{width:"80rem",children:"Tax"}),(0,T.jsx)(f.A,{width:"80rem",children:"Discount"}),(0,T.jsx)(f.A,{width:"60rem",children:"Amount"}),(0,T.jsx)(f.A,{children:"Action"})]})}),(0,T.jsx)(p.A,{children:R.map((e,t)=>(0,T.jsxs)(h.A,{children:[(0,T.jsxs)(f.A,{sx:{position:"relative"},children:[(0,T.jsx)(d.A,{fullWidth:!0,value:e.itemName,onChange:e=>ie(t,"itemName",e.target.value),placeholder:"Item Name",size:"small",required:!0,autoComplete:"off",InputProps:{endAdornment:e.itemName&&(0,T.jsx)(g.A,{size:"small",onClick:()=>ie(t,"itemName",""),edge:"end","aria-label":"clear",children:(0,T.jsx)(j.A,{fontSize:"small"})})},onKeyDown:e=>{G[t]&&G[t].length>0&&("ArrowDown"===e.key?(e.preventDefault(),V(e=>({...e,[t]:void 0===e[t]||e[t]===G[t].length-1?0:e[t]+1}))):"ArrowUp"===e.key?(e.preventDefault(),V(e=>({...e,[t]:e[t]&&0!==e[t]?e[t]-1:G[t].length-1}))):"Tab"!==e.key&&"Enter"!==e.key||void 0!==Q[t]&&G[t][Q[t]]&&(e.preventDefault(),le(t,G[t][Q[t]]),V(e=>({...e,[t]:void 0}))))}}),G[t]&&G[t].length>0&&(0,T.jsx)(a.A,{fullWidth:!0,sx:{position:"absolute",zIndex:10,background:"#fff",boxShadow:2,borderRadius:1,mt:1,width:"100%",maxHeight:180,overflowY:"auto"},children:G[t].map((e,n)=>(0,T.jsx)(a.A,{sx:{px:2,py:1,cursor:"pointer",borderBottom:"1px solid #eee",backgroundColor:Q[t]===n?"#e3f2fd":"#fff","&:hover":{backgroundColor:"#f0f0f0"}},onMouseEnter:()=>V(e=>({...e,[t]:n})),onMouseLeave:()=>V(e=>({...e,[t]:void 0})),onClick:()=>{le(t,e),V(e=>({...e,[t]:void 0}))},children:e.name},e._id||n))})]}),(0,T.jsx)(f.A,{children:(0,T.jsx)(d.A,{fullWidth:!0,type:"text",value:e.quantity,onChange:e=>ie(t,"quantity",e.target.value),size:"small",inputProps:{min:1,autoComplete:"off"},required:!0})}),(0,T.jsx)(f.A,{children:(0,T.jsx)(d.A,{fullWidth:!0,type:"text",value:"object"===typeof e.unitPrice&&null!==e.unitPrice&&"$numberDecimal"in e.unitPrice?e.unitPrice.$numberDecimal:e.unitPrice,onChange:e=>ie(t,"unitPrice",e.target.value),size:"small",inputProps:{min:0,autoComplete:"off"},required:!0})}),(0,T.jsx)(f.A,{children:(0,T.jsx)(d.A,{fullWidth:!0,type:"text",value:e.taxPercent,onChange:e=>ie(t,"taxPercent",e.target.value),size:"small",inputProps:{min:0,autoComplete:"off"}})}),(0,T.jsx)(f.A,{children:(0,T.jsx)(d.A,{fullWidth:!0,type:"text",value:e.tax,onChange:e=>ie(t,"tax",e.target.value),size:"small",inputProps:{min:0,autoComplete:"off"}})}),(0,T.jsx)(f.A,{children:(0,T.jsx)(d.A,{fullWidth:!0,type:"text",value:e.discount,onChange:e=>ie(t,"discount",e.target.value),size:"small",inputProps:{min:0,autoComplete:"off"}})}),(0,T.jsx)(f.A,{children:(0,T.jsx)(r.A,{children:e.amount.toFixed(2)})}),(0,T.jsxs)(f.A,{children:[(0,T.jsx)(g.A,{color:"error",onClick:()=>(e=>{O(R.filter((t,n)=>n!==e))})(t),disabled:1===R.length,children:(0,T.jsx)(A.A,{})}),t===R.length-1&&(0,T.jsx)(g.A,{color:"primary",onClick:ae,children:(0,T.jsx)(y.A,{})})]})]},t))})]})})]}),(0,T.jsxs)(l.A,{sx:{p:3,mb:3,borderRadius:3,boxShadow:2,background:"linear-gradient(90deg, #43cea2 0%, #185a9d 100%)",color:"#fff"},children:[(0,T.jsx)(r.A,{variant:"h6",gutterBottom:!0,children:"Billing Summary"}),(0,T.jsxs)(a.A,{sx:{flexGrow:1,display:"flex",flexDirection:{xs:"column",md:"row"},alignItems:{xs:"flex-start",md:"center"},justifyContent:"space-between",width:"100%",gap:2},children:[(0,T.jsxs)(a.A,{children:[(0,T.jsxs)(r.A,{variant:"subtitle1",children:["Total Amount: ",(0,T.jsxs)("b",{children:["\u20b9",re.toFixed(2)]})]}),(0,T.jsxs)(r.A,{variant:"subtitle1",children:["Total Tax: ",(0,T.jsxs)("b",{children:["\u20b9",oe?parseFloat(oe).toFixed(2):0]})]}),(0,T.jsxs)(r.A,{variant:"subtitle1",children:["Total Discount: ",(0,T.jsxs)("b",{children:["\u20b9",se.toFixed(2)]})]}),(0,T.jsxs)(r.A,{variant:"subtitle1",sx:{mt:1},children:["In Words: ",(0,T.jsxs)("i",{children:[q(Math.floor(re+oe))," Rupees Only"]})]})]}),(0,T.jsxs)(a.A,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:2,alignItems:"flex-end",width:{xs:"100%",md:"auto"}},children:[(0,T.jsx)(d.A,{label:"Remark",value:H,onChange:e=>Z(e.target.value),fullWidth:!0,multiline:!0,rows:2,sx:{minWidth:180,background:"#fff",borderRadius:1},inputProps:{autoComplete:"off"}}),(0,T.jsx)(d.A,{label:"Customer Notes",value:_,onChange:e=>K(e.target.value),fullWidth:!0,multiline:!0,rows:2,sx:{minWidth:180,background:"#fff",borderRadius:1},inputProps:{autoComplete:"off"}}),(0,T.jsx)(d.A,{select:!0,label:"Payment Method",name:"paymentMethod",value:U,onChange:e=>X(e.target.value),fullWidth:!0,required:!0,sx:{minWidth:180,background:"#fff",borderRadius:1},inputProps:{autoComplete:"off"},children:n&&n.map(e=>(0,T.jsx)(u.A,{value:null===e||void 0===e?void 0:e.paymentType,children:null===e||void 0===e?void 0:e.paymentType},null===e||void 0===e?void 0:e.paymentType))})]})]}),(0,T.jsx)(b.A,{sx:{my:2,borderColor:"rgba(255,255,255,0.3)"}}),(0,T.jsx)(a.A,{sx:{display:"flex",justifyContent:"flex-end"},children:(0,T.jsx)(o.A,{type:"submit",variant:"contained",color:"secondary",size:"large",onClick:t=>{t.preventDefault();const n={id:e,userId:B.customerId,plan:(null===M||void 0===M?void 0:M.billingType)||"",details:H,billingDetails:R.map(e=>({billingItems:e.billingItems?e.billingItems:"",name:e.itemName,quantity:e.quantity,unitPrice:e.unitPrice,totalPrice:e.amount,tax:e.tax||0,discount:e.discount||0})),customerName:B.name,customerAddress:B.address,customerPhone:B.contact,customerNotes:_,category:M.financialYear,invoiceNumber:`INV-${Date.now()}`,invoiceDate:M.billingDate||new Date,dueDate:new Date((new Date).setDate((new Date).getDate()+30)),totalAmount:re,taxAmount:R.reduce((e,t)=>e+(parseFloat(t.tax)||0),0),discountAmount:R.reduce((e,t)=>e+(parseFloat(t.discount)||0),0),finalAmount:re+R.reduce((e,t)=>e+(parseFloat(t.tax)||0),0)-R.reduce((e,t)=>e+(parseFloat(t.discount)||0),0),currency:"INR",paymentStatus:"Pending",paymentDate:new Date,paymentReference:"",paymentMethodDetails:U};E((0,S.JF)(n)).then(e=>{e.error?console.error("Error updating billing item:",e.error):setTimeout(()=>{ee(N.K.LISTBILLIS)},1e3)}).catch(e=>{console.error("Error adding billing item:",e)})},sx:{fontWeight:700,fontSize:16,background:"linear-gradient(90deg, #ff9966 0%, #ff5e62 100%)",color:"#fff",boxShadow:2,"&:hover":{background:"linear-gradient(90deg, #ff5e62 0%, #ff9966 100%)"}},children:"Submit Billing"})})]})]})}},86064:(e,t,n)=>{n.d(t,{MW:()=>a,Xw:()=>l,r7:()=>i});const i=e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(e).toLowerCase()),a=e=>/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/.test(String(e)),l=()=>window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth}}]);
//# sourceMappingURL=369.b3ecbd57.chunk.js.map