"use strict";(self.webpackChunktemh=self.webpackChunktemh||[]).push([[204],{7261:(e,t,n)=>{n.d(t,{A:()=>a});var i=n(99992),l=n(70579);const a=(0,i.A)((0,l.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m5 11H7v-2h10z"}),"RemoveCircle")},12204:(e,t,n)=>{n.r(t),n.d(t,{default:()=>W});var i=n(65043),l=n(53969),a=n(55895),r=n(66154),s=n(12097),o=n(94799),d=n(30998),u=n(47471),c=n(28259),m=n(87443),x=n(10756),h=n(86172),g=n(81341),p=n(34375),f=n(56647),A=n(94527),b=n(40146),j=n(7261),v=n(78916),y=n(83003),w=n(86064),C=n(88998),D=n(83965),P=n(23937),S=n(87804),I=n(61066),q=n(17193),N=n(70579);function T(e){if(0===e)return"Zero";"number"!==typeof e&&(e=Number(e));const t=["","One","Two","Three","Four","Five","Six","Seven","Eight","Nine","Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"],n=["","","Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety"],i=Math.floor(e/1e7),l=Math.floor(e%1e7/1e5),a=Math.floor(e%1e5/1e3),r=Math.floor(e%1e3/100),s=e%100;let o="";return i&&(o+=T(i)+" Crore "),l&&(o+=T(l)+" Lakh "),a&&(o+=T(a)+" Thousand "),r&&(o+=t[r]+" Hundred "),s&&(""!==o&&(o+="and "),o+=s<20?t[s]:n[Math.floor(s/10)]+(s%10?" "+t[s%10]:"")),o.trim()}const W=()=>{const{billingCategory:e}=(0,y.d4)(e=>e.billingCategory),{paymentType:t}=(0,y.d4)(e=>e.paymentType),{financialYears:n}=(0,y.d4)(e=>e.financialYear),{billingItems:W}=(0,y.d4)(e=>e.billingItems),[k,B]=(0,i.useState)(W||[]),z=(0,y.wA)();(0,i.useEffect)(()=>{z((0,C.s)()),z((0,D.H)()),z((0,P.dL)()),z((0,S.C9)())},[z]);const E=(0,w.Xw)(),[M,$]=(0,i.useState)({customerId:"",name:"",address:"",contact:""}),[F,Y]=(0,i.useState)({billingType:"",financialYear:"",billingDate:(new Date).toISOString().split("T")[0]}),[L,H]=(0,i.useState)([{billingItems:"",itemName:"",quantity:1,unitPrice:0,taxPercent:0,tax:0,amount:0,discount:0}]),[R,_]=(0,i.useState)(""),[O,U]=(0,i.useState)(""),[Z,G]=(0,i.useState)(""),[K,V]=(0,i.useState)({}),[X,Q]=(0,i.useState)({}),J=e=>{$({...M,[e.target.name]:e.target.value})},ee=e=>{Y({...F,[e.target.name]:e.target.value})},te=(e,t,n)=>{const i=L.map((i,l)=>{if(l!==e)return i;const a=e=>"object"===typeof e&&null!==e&&"$numberDecimal"in e?Number(e.$numberDecimal):Number(e)||0;let r={...i,[t]:["quantity","unitPrice","discount","taxPercent","tax"].includes(t)?a(n):n};return r.unitPrice=a(r.unitPrice),r.quantity=a(r.quantity),r.discount=a(r.discount),r.taxPercent=a(r.taxPercent),r.tax=a(r.tax),"taxPercent"!==t&&"unitPrice"!==t&&"quantity"!==t||(r.tax=(r.unitPrice*r.quantity*r.taxPercent/100).toFixed(2)),"tax"===t&&(r.taxPercent=r.unitPrice&&r.quantity?(100*r.tax/(r.unitPrice*r.quantity)).toFixed(2):0),r.amount=r.unitPrice*r.quantity+r.tax-r.discount,r});if(H(i),"itemName"===t){const t=W&&W.filter(e=>e.name.toLowerCase().includes(n.toLowerCase()));V(n=>({...n,[e]:t})),Q(t=>({...t,[e]:void 0}))}},ne=()=>{H([...L,{billingItems:"",itemName:"",quantity:0,unitPrice:0,taxPercent:0,tax:0,amount:0,discount:0}])},ie=(e,t)=>{const n=e=>"object"===typeof e&&null!==e&&"$numberDecimal"in e?Number(e.$numberDecimal):Number(e)||0,i=L.map((i,l)=>{if(l!==e)return i;const a=n(t.unitPrice),r=n(t.quantity)||1,s=n(t.taxPercent||t.tax_percent||0);let o=n(t.tax);s&&(o=a*r*s/100);const d=n(t.discount),u=a*r+o-d;return{...i,billingItems:t._id,itemName:t.name,quantity:r,unitPrice:a,taxPercent:s,tax:o,discount:d,amount:u}});H(i),V(t=>({...t,[e]:[]}))},le=L.reduce((e,t)=>e+t.amount,0),ae=L.reduce((e,t)=>{let n=t.tax;return n="object"===typeof n&&null!==n&&"$numberDecimal"in n?Number(n.$numberDecimal):Number(n)||0,e+n},0),re=L.reduce((e,t)=>{let n=t.discount;return n="object"===typeof n&&null!==n&&"$numberDecimal"in n?Number(n.$numberDecimal):Number(n)||0,e+n},0);return(0,N.jsxs)(l.A,{sx:{width:E-240+"px"},children:[(0,N.jsxs)(l.A,{sx:{display:"flex",border:"1px solid #ccc",backgroundColor:"#f5f5f5",padding:"10px",marginBottom:"20px"},children:[(0,N.jsx)(a.A,{variant:"h5",color:"textSecondary",children:"User Billing Information"}),(0,N.jsx)(r.A,{label:"Billing Date",name:"billingDate",type:"date",value:F.billingDate,onChange:ee,fullWidth:!0,InputLabelProps:{shrink:!0},required:!0,sx:{display:"none",marginLeft:"20px",marginRight:"20px",width:"200px"}}),(0,N.jsx)(s.A,{variant:"contained",color:"primary",sx:{marginLeft:"auto"},onClick:()=>window.location.href=q.K.LISTBILLIS,children:"Search Billings"})]}),(0,N.jsx)(l.A,{sx:{minWidth:550},children:(0,N.jsxs)("form",{onSubmit:e=>{var t;e.preventDefault();const n={userId:M.customerId,plan:(null===F||void 0===F||null===(t=F.billingType)||void 0===t?void 0:t.name)||"",details:R,billingDetails:L.map(e=>({billingItems:e.billingItems?e.billingItems:"",name:e.itemName,quantity:e.quantity,unitPrice:e.unitPrice,totalPrice:e.amount,tax:e.tax||0,discount:e.discount||0})),customerName:M.name,customerAddress:M.address,customerPhone:M.contact,category:F.financialYear,invoiceNumber:`INV-${Date.now()}`,invoiceDate:F.billingDate||new Date,dueDate:new Date((new Date).setDate((new Date).getDate()+30)),totalAmount:le,taxAmount:L.reduce((e,t)=>e+(t.tax||0),0),discountAmount:L.reduce((e,t)=>e+(t.discount||0),0),finalAmount:le+L.reduce((e,t)=>e+(t.tax||0),0)-L.reduce((e,t)=>e+(t.discount||0),0),currency:"INR",paymentStatus:"Pending",paymentDate:new Date,paymentReference:"",paymentMethodDetails:Z};console.log("Billing Data:",n),z((0,I.PM)(n)).then(e=>{e.error?console.error("Error adding billing item:",e.error):window.location.href="/list-billings"}).catch(e=>{console.error("Error adding billing item:",e)})},children:[(0,N.jsxs)(o.A,{sx:{mb:2},children:[(0,N.jsxs)(l.A,{sx:{display:"flex",flexDirection:"row",gap:10,alignItems:"center",justifyContent:"space-between",borderBottom:"1px solid #CECECE",padding:"10px",pt:2,mb:2,backgroundColor:"#f5f5f5",height:"20px"},children:[(0,N.jsx)(a.A,{variant:"h6",gutterBottom:!0,children:"Customer Info"}),(0,N.jsxs)(a.A,{variant:"h6",sx:{textAlign:"right",justifyContent:"flex-end"},gutterBottom:!0,children:["Date: ",(0,w.Yq)(F.billingDate)]})]}),(0,N.jsxs)(d.A,{container:!0,spacing:2,sx:{padding:2},children:[(0,N.jsx)(d.A,{item:!0,xs:12,sm:3,children:(0,N.jsx)(r.A,{label:"Customer ID",name:"customerId",value:M.customerId,onChange:J,fullWidth:!0,required:!0})}),(0,N.jsx)(d.A,{item:!0,xs:12,sm:3,children:(0,N.jsx)(r.A,{label:"Name",name:"name",value:M.name,onChange:J,fullWidth:!0,required:!0})}),(0,N.jsx)(d.A,{item:!0,xs:12,sm:3,children:(0,N.jsx)(r.A,{label:"Address",name:"address",value:M.address,onChange:J,fullWidth:!0,required:!0})}),(0,N.jsx)(d.A,{item:!0,xs:12,sm:3,children:(0,N.jsx)(r.A,{label:"Contact",name:"contact",value:M.contact,onChange:J,fullWidth:!0,required:!0})}),(0,N.jsx)(d.A,{item:!0,xs:12,sm:4,children:(0,N.jsx)(r.A,{select:!0,label:"Billing Type",name:"billingType",value:F.billingType,onChange:ee,fullWidth:!0,required:!0,sx:{width:180},children:e&&e.map(e=>(0,N.jsx)(u.A,{value:e,children:null===e||void 0===e?void 0:e.name},e))})})]})]}),(0,N.jsxs)(o.A,{sx:{p:2,mb:3,display:"none"},children:[(0,N.jsx)(a.A,{variant:"h6",gutterBottom:!0,children:"Billing Details"}),(0,N.jsx)(d.A,{container:!0,spacing:2,children:(0,N.jsx)(l.A,{sx:{display:"flex",flexDirection:"row",gap:2,width:"100%"},children:(0,N.jsx)(r.A,{select:!0,label:"Financial Year",name:"financialYear",value:F.financialYear?F.financialYear:"2025-26",onChange:ee,fullWidth:!0,required:!0,disabled:!0,children:n&&n.map(e=>(0,N.jsx)(u.A,{value:null===e||void 0===e?void 0:e.name,selected:!0,children:null===e||void 0===e?void 0:e.name},null===e||void 0===e?void 0:e._id))})})})]}),(0,N.jsxs)(o.A,{sx:{p:2,mb:3,minHeight:300},children:[(0,N.jsxs)(l.A,{sx:{display:"flex",flexDirection:"row",gap:10,alignItems:"center",justifyContent:"space-between",borderBottom:"1px solid #CECECE",padding:"10px",pt:2,mb:2,backgroundColor:"#f5f5f5",height:"20px"},children:[(0,N.jsx)(a.A,{variant:"h6",gutterBottom:!0,children:"Billing Details"}),(0,N.jsxs)(a.A,{variant:"h6",sx:{textAlign:"right",justifyContent:"flex-end"},gutterBottom:!0,children:["Financial Year: ",F.financialYear?F.financialYear:"2025-26"]})]}),(0,N.jsx)(c.A,{sx:{minHeight:300},children:(0,N.jsxs)(m.A,{size:"small",children:[(0,N.jsx)(x.A,{children:(0,N.jsxs)(h.A,{children:[(0,N.jsx)(g.A,{width:"450rem",children:"Item Name"}),(0,N.jsx)(g.A,{width:"60rem",children:"Quantity"}),(0,N.jsx)(g.A,{width:"120rem",children:"Unit Price"}),(0,N.jsx)(g.A,{width:"80rem",children:"Tax %"})," ",(0,N.jsx)(g.A,{width:"80rem",children:"Tax"}),(0,N.jsx)(g.A,{width:"80rem",children:"Discount"}),(0,N.jsx)(g.A,{width:"60rem",children:"Amount"}),(0,N.jsx)(g.A,{children:"Action"})]})}),(0,N.jsx)(p.A,{children:L.map((e,t)=>{var n;return(0,N.jsxs)(h.A,{children:[(0,N.jsxs)(g.A,{sx:{position:"relative"},children:[(0,N.jsx)(r.A,{fullWidth:!0,value:e.itemName,onChange:e=>te(t,"itemName",e.target.value),placeholder:"Item Name",size:"small",required:!0,autoComplete:"off",InputProps:{endAdornment:e.itemName&&(0,N.jsx)(f.A,{size:"small",onClick:()=>te(t,"itemName",""),edge:"end","aria-label":"clear",children:(0,N.jsx)(v.A,{fontSize:"small"})})},onKeyDown:e=>{K[t]&&K[t].length>0&&("ArrowDown"===e.key?(e.preventDefault(),Q(e=>({...e,[t]:void 0===e[t]||e[t]===K[t].length-1?0:e[t]+1}))):"ArrowUp"===e.key?(e.preventDefault(),Q(e=>({...e,[t]:e[t]&&0!==e[t]?e[t]-1:K[t].length-1}))):"Tab"!==e.key&&"Enter"!==e.key||void 0!==X[t]&&K[t][X[t]]&&(e.preventDefault(),ie(t,K[t][X[t]]),Q(e=>({...e,[t]:void 0}))))}}),K[t]&&K[t].length>0&&(console.log("Item Suggestions:",K),(0,N.jsx)(l.A,{fullWidth:!0,sx:{position:"absolute",zIndex:10,background:"#fff",boxShadow:2,borderRadius:1,mt:1,width:"100%",maxHeight:180,overflowY:"auto"},children:K[t].map((e,n)=>(console.log("Suggestion:",e),(0,N.jsx)(l.A,{sx:{px:2,py:1,cursor:"pointer",borderBottom:"1px solid #eee",backgroundColor:X[t]===n?"#e3f2fd":"#fff","&:hover":{backgroundColor:"#f0f0f0"}},onMouseEnter:()=>Q(e=>({...e,[t]:n})),onMouseLeave:()=>Q(e=>({...e,[t]:void 0})),onClick:()=>{ie(t,e),Q(e=>({...e,[t]:void 0}))},children:e.name},e._id||n)))}))]}),(0,N.jsx)(g.A,{children:(0,N.jsx)(r.A,{fullWidth:!0,type:"text",value:e.quantity,onChange:e=>te(t,"quantity",e.target.value),size:"small",inputProps:{min:1},required:!0})}),(0,N.jsx)(g.A,{children:(0,N.jsx)(r.A,{fullWidth:!0,type:"text",value:"object"===typeof e.unitPrice&&null!==e.unitPrice&&"$numberDecimal"in e.unitPrice?e.unitPrice.$numberDecimal:e.unitPrice,onChange:e=>te(t,"unitPrice",e.target.value),size:"small",inputProps:{min:0},required:!0})}),(0,N.jsx)(g.A,{children:(0,N.jsx)(r.A,{fullWidth:!0,type:"text",value:e.taxPercent,onChange:e=>te(t,"taxPercent",e.target.value),size:"small",inputProps:{min:0}})}),(0,N.jsx)(g.A,{children:(0,N.jsx)(r.A,{fullWidth:!0,type:"text",value:e.tax,onChange:e=>te(t,"tax",e.target.value),size:"small",inputProps:{min:0}})}),(0,N.jsx)(g.A,{children:(0,N.jsx)(r.A,{fullWidth:!0,type:"text",value:null===(n=e.discount)||void 0===n?void 0:n.$numberDecimal,onChange:e=>te(t,"discount",e.target.value),size:"small",inputProps:{min:0}})}),(0,N.jsx)(g.A,{children:(0,N.jsx)(a.A,{children:e.amount.toFixed(2)})}),(0,N.jsxs)(g.A,{children:[(0,N.jsx)(f.A,{color:"error",onClick:()=>(e=>{H(L.filter((t,n)=>n!==e))})(t),disabled:1===L.length,children:(0,N.jsx)(j.A,{})}),t===L.length-1&&(0,N.jsx)(f.A,{color:"primary",onClick:ne,children:(0,N.jsx)(b.A,{})})]})]},t)})})]})})]}),(0,N.jsxs)(o.A,{sx:{p:2,mb:3},children:[(0,N.jsx)(a.A,{variant:"h6",gutterBottom:!0,children:"Billing Summary"}),(0,N.jsxs)(l.A,{sx:{flexGrow:1,display:"flex",flex:1,width:"100%",flexDirection:"column",alignItems:"flex-end"},children:[(0,N.jsxs)(a.A,{variant:"subtitle1",children:["Total Amount: ",(0,N.jsxs)("b",{children:["\u20b9",le.toFixed(2)]})]}),(0,N.jsxs)(a.A,{variant:"subtitle1",children:["Total Tax: ",(0,N.jsxs)("b",{children:["\u20b9",ae?parseFloat(ae).toFixed(2):0]})]}),(0,N.jsxs)(a.A,{variant:"subtitle1",children:["Total Discount: ",(0,N.jsxs)("b",{children:["\u20b9",re.toFixed(2)]})]}),(0,N.jsxs)(a.A,{variant:"subtitle1",sx:{mt:1,alignSelf:"flex-end",ml:2},children:["In Words: ",(0,N.jsxs)("i",{children:[T(Math.floor(le+ae))," Rupees Only"]})]})]}),(0,N.jsxs)(l.A,{sx:{flexGrow:1,display:"flex",flex:1,width:"100%",flexDirection:"row",gap:2,alignItems:"flex-end"},children:[(0,N.jsx)(r.A,{label:"Remark",value:R,onChange:e=>_(e.target.value),fullWidth:!0,multiline:!0,rows:2}),(0,N.jsx)(r.A,{label:"Customer Note",value:O,onChange:e=>U(e.target.value),fullWidth:!0,multiline:!0,rows:2,sx:{mt:2}}),(0,N.jsx)(r.A,{select:!0,label:"Payment Method",name:"paymentMethod",value:Z,onChange:e=>G(e.target.value),fullWidth:!0,sx:{mt:2},required:!0,children:t&&t.map(e=>(0,N.jsx)(u.A,{value:null===e||void 0===e?void 0:e.paymentType,children:null===e||void 0===e?void 0:e.paymentType},null===e||void 0===e?void 0:e.paymentType))})]})]}),(0,N.jsx)(A.A,{sx:{mb:2}}),(0,N.jsx)(s.A,{type:"submit",variant:"contained",color:"primary",size:"large",children:"Submit Billing"})]})})]})}},40146:(e,t,n)=>{n.d(t,{A:()=>a});var i=n(99992),l=n(70579);const a=(0,i.A)((0,l.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m5 11h-4v4h-2v-4H7v-2h4V7h2v4h4z"}),"AddCircle")},78916:(e,t,n)=>{n.d(t,{A:()=>a});var i=n(99992),l=n(70579);const a=(0,i.A)((0,l.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear")},86064:(e,t,n)=>{n.d(t,{MW:()=>a,Xw:()=>r,Yq:()=>i,r7:()=>l});const i=e=>new Date(e).toLocaleDateString(void 0,{day:"numeric",month:"long",year:"numeric"}),l=e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(e).toLowerCase()),a=e=>/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/.test(String(e)),r=()=>window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth}}]);
//# sourceMappingURL=204.0e19a868.chunk.js.map